jobs:

  test:
    docker: docker://golang:1.11
    entrypoint: |
      pwd
      .scripts/test.sh 'base'

    mount:
      script: /go/src/github.com/boomfunc/root/.scripts
      src: /go/src/github.com/boomfunc/root


  build:
    docker: docker://golang:1.11
    entrypoint: |
      .scripts/build-bin.sh 'base'

    mount:
      script: /go/src/github.com/boomfunc/root/.scripts
      artifact: /go/bin
      src: /go/src/github.com/boomfunc/root


  deploy:
    docker: docker://atlassian/pipelines-awscli
    entrypoint: |
      pwd
      ls -lah /go/bin

      mkdir -p /lib64
      ln -s /lib/libc.musl-x86_64.so.1 /lib64/ld-linux-x86-64.so.2

      /go/bin/base-$(uname -s)-$(uname -m) help

    mount:
      artifact: /go/bin

direct: [test, build, deploy]
indirect: [test]
