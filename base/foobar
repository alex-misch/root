jobs:

  test:
    docker: docker://golang:1.11
    entrypoint: |
      pwd
      .scripts/test.sh 'base'

    mount:
      script: /go/src/github.com/boomfunc/root/.scripts
      src: /go/src/github.com/boomfunc/root


  build:
    docker: docker://golang:1.11
    entrypoint: |
      .scripts/build-bin.sh 'base'

    mount:
      script: /go/src/github.com/boomfunc/root/.scripts
      artifact: /go/bin
      src: /go/src/github.com/boomfunc/root


  deploy:
    docker: docker://docker:latest
    entrypoint: |
      cat ./base/Dockerfile

      docker login --username=gurinov --password=Zx1991cv
      docker build -t boomfunc/base:ttt ./base
      docker push boomfunc/base:ttt

    mount:
      artifact: /go/bin
      src: /go/src/github.com/boomfunc/root

direct: [test, build, deploy]
indirect: [test]
