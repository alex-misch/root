

collection:

  # Route
  # AWS ECS ping
  - pattern: "/ssr/{node:com/jetsmarter.charter}/sitemap.xml"
    pipeline:
      - type: process
        cmd: >
          node
          --experimental-modules
          --no-warnings
          --experimental-vm-modules
          ./sitemap.mjs
          --output=stdout
          --origin=https://jetsmarter.com/
          --src=https://jetsmarter.com/data/jscomv5/index.es.js
        # --src=https://d35qz7xn7nfid5.cloudfront.net/ssr/index.es.js

      - type: plugin
        path: ./ssr-Linux-x86_64.so
        name: JsonEntrypoint


  # Clear cache
  - pattern: "/{node:com/jetsmarter.charter}/cleanthisbitch"
    pipeline:

      - type: process
        cmd: rm -rf ./cache/data/{{url "node"}}

  # Server side rendering for charter.jetsmarter.com
  - pattern: "/ssr/{node:com/jetsmarter.charter}/{url:*}"
    pipeline:

      - type: process
        cmd: >
          node
          --experimental-modules
          --no-warnings
          --experimental-vm-modules
          ./render.mjs
          --url=/{{url "url"}}
          --ip={{meta "ip"}}
          --user-agent='{{meta "ua"}}'
          --src=https://jetsmarter.com/data/{{url "node"}}/index.es.js
          --origin=https://charter.jetsmarter.com/

      - type: plugin
        path: ./ssr-Linux-x86_64.so
        name: JsonEntrypoint


  # Clear cache
  - pattern: "/{node:com/jetsmarter}/cleanthisbitch"
    pipeline:

      - type: process
        cmd: rm -rf ./cache/data/{{url "node"}}

  # Server side rendering for jetsmarter.com
  - pattern: "/ssr/{node:com/jetsmarter}/{url:*}"
    pipeline:

      - type: process
        cmd: >
          node
          --experimental-modules
          --no-warnings
          --experimental-vm-modules
          ./render.mjs
          --url=/{{url "url"}}
          --ip={{meta "ip"}}
          --user-agent='{{meta "ua"}}'
          --src=https://jetsmarter.com/data/{{url "node"}}/index.es.js
          --origin=https://jetsmarter.com/

      - type: plugin
        path: ./ssr-Linux-x86_64.so
        name: JsonEntrypoint



  # Clear cache
  - pattern: "/{node:com/jetsmarter.biggame}/cleanthisbitch"
    pipeline:

      - type: process
        cmd: rm -rf ./cache/data/{{url "node"}}

  # Server side rendering for biggame.jetsmarter.com
  - pattern: "/ssr/{node:com/jetsmarter.biggame}/{url:*}"
    pipeline:

      - type: process
        cmd: >
          node
          --experimental-modules
          --no-warnings
          --experimental-vm-modules
          ./render.mjs
          --url=/{{url "url"}}
          --ip={{meta "ip"}}
          --user-agent='{{meta "ua"}}'
          --src=https://jetsmarter.com/data/{{url "node"}}/index.es.js
          --origin=https://biggame.jetsmarter.com/

      - type: plugin
        path: ./ssr-Linux-x86_64.so
        name: JsonEntrypoint



  # Clear cache
  - pattern: "/{node:com/jetsmarter.crowdfund}/cleanthisbitch"
    pipeline:

      - type: process
        cmd: rm -rf ./cache/data/{{url "node"}}

  # Server side rendering for crowdfund.jetsmarter.com
  - pattern: "/ssr/{node:com/jetsmarter.crowdfund}/{url:*}"
    pipeline:

      - type: process
        cmd: >
          node
          --experimental-modules
          --no-warnings
          --experimental-vm-modules
          ./render.mjs
          --url=/{{url "url"}}
          --ip={{meta "ip"}}
          --user-agent='{{meta "ua"}}'
          --src=https://jetsmarter.com/data/{{url "node"}}/index.es.js
          --origin=https://crowdfund.jetsmarter.com/

      - type: plugin
        path: ./ssr-Linux-x86_64.so
        name: JsonEntrypoint

  # Route
  # AWS ECS ping
  - pattern: "/ping"
    pipeline:

      - type: process
        cmd: echo pong

  # Serve static data
  # - pattern: "/data/{url:*}"
  #   pipeline:

  #     - type: process
  #       cmd: cat ./cache/{{url "url"}}
