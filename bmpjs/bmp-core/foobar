jobs:

  test:
    docker: docker://node:10-alpine
    workdir: ./bmpjs/bmp-core
    entrypoint: |
      echo 'tested'

    mount:
      src: /tmp/src
      cache: /tmp/src/node_modules
      # artifact: /tmp/src/dist

  build:
    docker: docker://node:10-alpine
    workdir: ./bmpjs/bmp-core
    entrypoint: |
      npm install
      node --experimental-modules ./install.mjs --no-cache
      node --experimental-modules ./build.mjs

    mount:
      src: /tmp/src
      cache: /tmp/src/node_modules
      artifact: /tmp/src/dist


  deploy:
    docker: docker://atlassian/pipelines-awscli
    workdir: /tmp/art
    entrypoint: |
      ls -lah /tmp/art

    mount:
      artifact: /tmp/art

deps:
  - base

direct: [test, build, deploy]
indirect: [test]
